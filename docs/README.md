# Koatty
Koa2 + Typescript = Koatty. 

Use Typescript's decorator implement IOC and AOP, just like SpringBoot.

Koattyæ˜¯åŸºäºKoa2å®ç°çš„ä¸€ä¸ªå…·å¤‡IOCè‡ªåŠ¨ä¾èµ–æ³¨å…¥ä»¥åŠAOPåˆ‡é¢ç¼–ç¨‹çš„æ•æ·å¼€å‘æ¡†æ¶ï¼Œç”¨æ³•ç±»ä¼¼SpringBootã€‚

[![Version npm](https://img.shields.io/npm/v/koatty.svg?style=flat-square)](https://www.npmjs.com/package/koatty)[![npm Downloads](https://img.shields.io/npm/dm/koatty.svg?style=flat-square)](https://npmcharts.com/compare/koatty?minimal=true)

# å¿«é€Ÿå¼€å§‹

## ç¬¬ä¸€ä¸ªåº”ç”¨

### 1.å®‰è£…å‘½ä»¤è¡Œå·¥å…·

```bash
npm i -g koatty_cli
```
å‘½ä»¤è¡Œå·¥å…·çš„ç‰ˆæœ¬åŒKoattyæ¡†æ¶çš„ç‰ˆæœ¬æ˜¯å¯¹åº”çš„ï¼Œä¾‹å¦‚ koatty_cli@1.11.x æ”¯æŒ koatty@1.11.xç‰ˆæœ¬çš„æ–°ç‰¹æ€§ã€‚

### 2.æ–°å»ºé¡¹ç›®

```bash
koatty new projectName

cd ./projectName

yarn install


```

### 3.å¯åŠ¨æœåŠ¡
```bash
// devæ¨¡å¼
npm run dev

// proæ¨¡å¼
npm start

```

 æµè§ˆå™¨ä¸­è®¿é—®  `http://localhost:3000/`. 

## è°ƒè¯•æ¨¡å¼

å¢™è£‚æ¨èä½¿ç”¨Visual Studio Code(ç®€ç§° VScode)è¿›è¡Œå¼€å‘, ç¼–è¾‘é¡¹ç›®ç›®å½•ä¸‹çš„ .vscode/launch.jsonæ–‡ä»¶ï¼ˆç‚¹å‡»è°ƒè¯•-é…ç½®ä¹Ÿå¯ä»¥æ‰“å¼€ï¼‰:

```js
{
    "version": "0.2.0",
    "configurations": [
        {
            "type": "node",
            "request": "launch",
            "name": "TS Program",
            "args": [
                "${workspaceRoot}/src/App.ts" 
            ],
            "runtimeArgs": [
                "--nolazy",
                "-r",
                "ts-node/register"
            ],
            "sourceMaps": true,
            "cwd": "${workspaceRoot}",
            "protocol": "inspector",
            "internalConsoleOptions": "neverOpen"
        }
    ]
}
```

é€‰æ‹© `TS Program` ä»¥debugæ¨¡å¼å¯åŠ¨.

# åŸºç¡€åŠŸèƒ½

## é¡¹ç›®ç»“æ„

Koattyçš„å‘½ä»¤è¡Œå·¥å…·`koatty_cli`åœ¨åˆ›å»ºé¡¹ç›®çš„æ—¶å€™ï¼Œé»˜è®¤ä¼šå½¢æˆä»¥ä¸‹ç›®å½•ç»“æ„:

 ```bash
<projectName>
â”œâ”€â”€ .vscode                       # vscodeé…ç½®
â”‚   â””â”€â”€ launch.json               # nodeæœ¬åœ°è°ƒè¯•è„šæœ¬
â”œâ”€â”€ dist                          # ç¼–è¯‘åç›®å½•
â”œâ”€â”€ src                           # é¡¹ç›®æºä»£ç 
â”‚   â”œâ”€â”€ config
â”‚   â”‚   â”œâ”€â”€ config.ts             # æ¡†æ¶é…ç½®
â”‚   â”‚   â”œâ”€â”€ db.ts                 # å­˜å‚¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ middleware.ts         # ä¸­é—´ä»¶é…ç½®
â”‚   â”‚   â”œâ”€â”€ plugin.ts             # æ’ä»¶é…ç½®
â”‚   â”‚   â””â”€â”€ router.ts             # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ controller                # æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ TestController.ts
â”‚   â”œâ”€â”€ middleware                # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ JwtMiddleware.ts
â”‚   â”‚   â””â”€â”€ ViewMiddleware.ts
â”‚   â”œâ”€â”€ model                     # æŒä¹…å±‚
â”‚   â”‚   â””â”€â”€ TestModel.ts
â”‚   â”œâ”€â”€ plugin                    # æ’ä»¶
â”‚   â”‚   â””â”€â”€ TestPlugin.ts
â”‚   â”œâ”€â”€ proto                     # pbåè®®
â”‚   â”‚   â””â”€â”€ helloworld.proto
â”‚   â”œâ”€â”€ resource                  # ç”¨äºå­˜æ”¾é™æ€æ•°æ®æˆ–ç™½åå•ç­‰
â”‚   â”‚   â””â”€â”€ data.json
â”‚   â”œâ”€â”€ service                   # serviceé€»è¾‘å±‚
â”‚   â”‚   â””â”€â”€ TestService.ts
â”‚   â”œâ”€â”€ utils                     # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ App.ts                    # å…¥å£æ–‡ä»¶
â”œâ”€â”€ static                        # é™æ€æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ test                          # æµ‹è¯•ç”¨ä¾‹
â”‚   â””â”€â”€ index.test.js
â”œâ”€â”€ apidoc.json
â”œâ”€â”€ pm2.json
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â””â”€â”€ tsconfig.json
 ```

ä½†æ˜¯Koattyæ”¯æŒçµæ´»çš„è‡ªå®šä¹‰é¡¹ç›®ç»“æ„ï¼Œé™¤é…ç½®ç›®å½•(é€šè¿‡@ConfiguationScan()å®šåˆ¶)ä»¥åŠé™æ€èµ„æºç›®å½•(éœ€è¦ä¿®æ”¹Staticä¸­é—´ä»¶é»˜è®¤é…ç½®)ä»¥å¤–ï¼Œå…¶ä»–ç›®å½•åç§°ã€ç»“æ„ç­‰éƒ½å¯ä»¥è‡ªè¡Œå®šåˆ¶ã€‚

## å…¥å£æ–‡ä»¶

Koattyé»˜è®¤çš„å…¥å£æ–‡ä»¶æ˜¯ `App.ts`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```js
import { Koatty, Bootstrap } from "koatty";
// import * as path from "path";

@Bootstrap(
    //bootstrap function
    // (app: any) => {
    //è°ƒæ•´libuvçº¿ç¨‹æ± å¤§å°
    // process.env.UV_THREADPOOL_SIZE = "128";
    //å¿½ç•¥httpsè‡ªç­¾åéªŒè¯
    // process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';
    // }
)
// @ComponentScan('./')
// @ConfiguationScan('./config')
export class App extends Koatty {
    public init() {
        // this.appDebug = true; //çº¿ä¸Šç¯å¢ƒè¯·å°†debugæ¨¡å¼å…³é—­ï¼Œå³ï¼šappDebug:false
    }
}
```

Appç±»ç»§æ‰¿äºKoattyç±»ï¼Œè€ŒKoattyæ˜¯å¯¹äºKoaçš„ç»§æ‰¿å’Œæ‰©å±•ã€‚å› æ­¤å¯ä»¥è®¤ä¸ºAppç±»çš„å®ä¾‹å°±æ˜¯koaç±»çš„å®ä¾‹(è¿›è¡Œäº†æ‰©å±•) appå¯¹è±¡ã€‚

Koattyé€šè¿‡`@Bootstrap()`è£…é¥°å™¨æ¥å®šä¹‰é¡¹ç›®å…¥å£ï¼Œ`@Bootstrap()`å¯ä»¥æ¥å—å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°åœ¨é¡¹ç›®åŠ è½½å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡`appReady`äº‹ä»¶è§¦å‘æ‰§è¡Œã€‚

å¦‚æœä¿®æ”¹äº†é¡¹ç›®ç›®å½•æˆ–è€…æƒ³æ’é™¤æŸäº›ç›®å½•Beanä¸è‡ªåŠ¨è¿›è¡ŒåŠ è½½ï¼Œå¯ä»¥é€šè¿‡`@ComponentScan()`è£…é¥°å™¨è¿›è¡Œå®šåˆ¶ã€‚

`@ConfiguationScan()`è£…é¥°å™¨ç”¨äºå®šåˆ¶é¡¹ç›®é…ç½®æ–‡ä»¶ç›®å½•ã€‚

`appDebug` å€¼ä¸º`true`æ—¶ï¼ŒnodeEnvç¯å¢ƒåœ¨ `development` æ¨¡å¼ã€‚å¹¶ä¸”æ§åˆ¶å™¨æ‰“å°è¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ã€‚

## åŸºç¡€å¯¹è±¡

### App

App æ˜¯å…¨å±€åº”ç”¨å¯¹è±¡ï¼Œåœ¨ä¸€ä¸ªåº”ç”¨ä¸­ï¼Œåªä¼šå®ä¾‹åŒ–ä¸€ä¸ªï¼Œå®ƒç»§æ‰¿è‡ª Koa.Applicationï¼Œåœ¨å®ƒä¸Šé¢æˆ‘ä»¬å¯ä»¥æŒ‚è½½ä¸€äº›å…¨å±€çš„æ–¹æ³•å’Œå¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥è½»æ¾çš„åœ¨æ’ä»¶æˆ–è€…åº”ç”¨ä¸­æ‰©å±• App å¯¹è±¡ã€‚

åœ¨`CONTROLLER`,`SERVICE`,`COMPONENT`ç±»å‹beanä¸­é»˜è®¤å·²ç»æ³¨å…¥äº†Appå¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œä½¿ç”¨:

```js
@Controller()
export class TestController extends BaseController {
    ...

    test() {
        //æ‰“å°appå¯¹è±¡
        console.log(this.app);
    }
}
```

åœ¨`MIDDLEWARE`ç±»å‹beanä¸­ï¼ŒAppå¯¹è±¡ä½œä¸ºå‡½æ•°å…¥å‚ä¼ é€’ï¼š

```js
@Middleware()
export class TestMiddleware implements IMiddleware {
    run(options: any, app: Koatty) {
        ...
        //æ‰“å°appå¯¹è±¡
        console.log(app);
    }
}
```

### Ctx

Ctx æ˜¯ä¸€ä¸ªè¯·æ±‚çº§åˆ«çš„å¯¹è±¡ï¼Œç»§æ‰¿è‡ª Koa.Contextã€‚åœ¨æ¯ä¸€æ¬¡æ”¶åˆ°ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œæ¡†æ¶ä¼šå®ä¾‹åŒ–ä¸€ä¸ª Ctx å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°è£…äº†è¿™æ¬¡ç”¨æˆ·è¯·æ±‚çš„ä¿¡æ¯ï¼Œå¹¶æä¾›äº†è®¸å¤šä¾¿æ·çš„æ–¹æ³•æ¥è·å–è¯·æ±‚å‚æ•°æˆ–è€…è®¾ç½®å“åº”ä¿¡æ¯ã€‚

åœ¨ `CONTROLLER`ç±»å‹beanä¸­ï¼ŒCtxå¯¹è±¡ä½œä¸ºæˆå‘˜å±æ€§ã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š

```js
@Controller()
export class TestController extends BaseController {
    ...

    test() {
        //æ‰“å°ctxå¯¹è±¡
        console.log(this.ctx);
    }
}
```

åœ¨`MIDDLEWARE`ç±»å‹beanä¸­ï¼ŒCtxå¯¹è±¡ä½œä¸ºä¸­é—´ä»¶æ‰§è¡Œå‡½æ•°å…¥å‚ä¼ é€’ï¼š

```js
@Middleware()
export class TestMiddleware implements IMiddleware {
    run(options: any, app: Koatty) {
        ...
        
        return async function (ctx: any, next: any) {
            
            //æ‰“å°ctxå¯¹è±¡
            console.log(ctx);

            return next();
        };
    }
}

```

åœ¨`SERVICE`,`COMPONENT`ç±»å‹beanä¸­ï¼ŒCtxå¯¹è±¡éœ€è¦è‡ªè¡Œä¼ é€’ã€‚

## é…ç½®

å®é™…é¡¹ç›®ä¸­ï¼Œè‚¯å®šéœ€è¦å„ç§é…ç½®ï¼ŒåŒ…æ‹¬ï¼šæ¡†æ¶éœ€è¦çš„é…ç½®ä»¥åŠé¡¹ç›®è‡ªå®šä¹‰çš„é…ç½®ã€‚Koatty å°†æ‰€æœ‰çš„é…ç½®éƒ½ç»Ÿä¸€ç®¡ç†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„åŠŸèƒ½åˆ’åˆ†ä¸ºä¸åŒçš„é…ç½®æ–‡ä»¶ã€‚

* config.ts é€šç”¨çš„ä¸€äº›é…ç½®
* db.ts æ•°æ®åº“é…ç½®
* router.ts è·¯ç”±é…ç½®
* middleware.ts ä¸­é—´ä»¶é…ç½®
* plugin.ts æ’ä»¶é…ç½®

é™¤ä¸Šè¿°å¸¸è§çš„é…ç½®æ–‡ä»¶ä¹‹å¤–ï¼ŒKoattyä¹Ÿæ”¯æŒç”¨æˆ·è‡ªè¡Œå®šä¹‰çš„é…ç½®æ–‡ä»¶å‘½åã€‚


### è‡ªå®šä¹‰é…ç½®æ‰«æè·¯å¾„

é…ç½®æ–‡ä»¶é»˜è®¤æ”¾åœ¨ src/config/ ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡åœ¨å…¥å£æ–‡ä»¶App.tsç±»è‡ªå®šä¹‰é…ç½®æ‰«æè·¯å¾„ï¼š

```js
//App.ts

@ConfiguationScan('./myconfig')
export class App extends Koatty {

    public init() {
        ...
    }
}
```

Koattyå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ‰«æé¡¹ç›® src/myconfigç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶(.ts),æŒ‰ç…§æ–‡ä»¶ååˆ†ç±»åŠ è½½ä¸ºé…ç½®

### é…ç½®æ–‡ä»¶æ ¼å¼

Koattyçš„é…ç½®æ–‡ä»¶å¿…é¡»æ˜¯æ ‡å‡†çš„ES6 Moduleæ ¼å¼è¿›è¡Œå¯¼å‡º,å¦åˆ™ä¼šæ— æ³•åŠ è½½ã€‚æ ¼å¼å¦‚ä¸‹ï¼š

```js
export default {
    /*database config*/
    database: {
        db_type: 'mysql', //support  postgresql,mysql...
        db_host: '127.0.0.1',
        db_port: 3306,
        db_name: 'test',
        db_user: 'test',
        db_pwd: '',
        db_prefix: '',
        db_charset: 'utf8'
    }
}

```

### è¯»å–é…ç½®

åœ¨é¡¹ç›®ä¸­æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥å¾ˆæ–¹ä¾¿çš„è¯»å–é…ç½®ï¼š

* æ–¹å¼ä¸€(æ§åˆ¶å™¨ã€serviceç­‰å«æœ‰appå±æ€§çš„ç±»ä¸­ä½¿ç”¨):

```js
//
...
const conf: any = this.app.config("test");

```
* æ–¹å¼äºŒ(åˆ©ç”¨è£…é¥°å™¨è¿›è¡Œæ³¨å…¥ï¼Œæ¨èç”¨æ³•)

```js
@Controller()
export class AdminController {
    @Value("test")
    conf: any;
}

```
### é…ç½®åˆ†ç±»åŠå±‚çº§

Koattyåœ¨å¯åŠ¨æ‰«æé…ç½®æ–‡ä»¶ç›®å½•æ—¶ï¼Œä¼šæŒ‰ç…§æ–‡ä»¶åå¯¹é…ç½®è¿›è¡Œåˆ†ç±»ã€‚ä¾‹å¦‚ï¼šdb.tsåŠ è½½å®Œæˆåï¼Œè¯»å–è¯¥æ–‡ä»¶å†…çš„é…ç½®é¡¹éœ€è¦å¢åŠ ç±»å‹

```js
// configå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºç±»å‹
const conf: any = this.app.config("test", "db");

æˆ–è€…

@Value("test", "db")
conf: any;

```

Koattyåœ¨è¯»å–é…ç½®æ—¶æ”¯æŒé…ç½®å±‚çº§ï¼Œä¾‹å¦‚é…ç½®æ–‡ä»¶db.tsï¼š

```js
export default {
    /*database config*/
    database: {
        db_type: 'mysql', //support  postgresql,mysql...
        db_host: '127.0.0.1',
        db_port: 3306,
        db_name: 'test',
        db_user: 'test',
        db_pwd: '',
        db_prefix: '',
        db_charset: 'utf8'
    }
}
```

è¯»å– `db_host`çš„å€¼ï¼š

```js
@Value("database.db_host", "db")
dbHost: string;

æˆ–è€…

const dbHost: string = this.app.config("database.db_host", "db");

```


éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œå±‚çº§é…ç½®ä»…æ”¯æŒç›´æ¥è®¿é—®åˆ°`äºŒçº§`ï¼Œæ›´æ·±çš„å±‚çº§è¯·èµ‹å€¼åå†æ¬¡è·å–:

```js
//config
export default {
    test: {
        bb: {
            cc: 1
        }
    }
}

const conf: any = this.app.config("test");
const cc: number = conf.bb.cc;
```

### è¿è¡Œç¯å¢ƒé…ç½®

Koattyå¯ä»¥è‡ªåŠ¨è¯†åˆ«å½“å‰è¿è¡Œç¯å¢ƒï¼Œå¹¶ä¸”æ ¹æ®è¿è¡Œç¯å¢ƒè‡ªåŠ¨åŠ è½½ç›¸åº”é…ç½®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚

è¿è¡Œç¯å¢ƒç”±ä¸‰ä¸ªå±æ€§æ¥è¿›è¡Œå®šä¹‰ï¼š

* appDebug

	åœ¨é¡¹ç›®å…¥å£æ–‡ä»¶çš„æ„é€ æ–¹æ³•ï¼ˆinitï¼‰å†…è¿›è¡Œå®šä¹‰

```js
//App.ts
@Bootstrap()
export class App extends Koatty {
    public init() {
        //appDebugå€¼ä¸ºtrueæ—¶ï¼Œdevelopmentæ¨¡å¼
        //appDebugå€¼ä¸ºfalseæ—¶ï¼Œproductionæ¨¡å¼
        this.appDebug = false;
    }
}
```

* process.env.NODE_ENV

	Node.jsçš„è¿è¡Œæ—¶ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥åœ¨ç³»ç»Ÿç¯å¢ƒå®šä¹‰ï¼Œä¹Ÿå¯ä»¥åœ¨é¡¹ç›®å…¥å£æ–‡ä»¶å¯åŠ¨å‡½æ•°ä¸­å®šä¹‰

* process.env.KOATTY_ENV

	Koattyæ¡†æ¶è¿è¡Œæ—¶ç¯å¢ƒå˜é‡


ä¸‰è€…ä¹‹é—´çš„å…³ç³»å’ŒåŒºåˆ«ï¼š

| å˜é‡                   | å–å€¼                   | è¯´æ˜                  | ä¼˜å…ˆçº§ |
| ---------------------- | ---------------------- | --------------------- | ------ |
| appDebug               | true/false             | è°ƒè¯•æ¨¡å¼              | ä½     |
| process.env.NODE_ENV   | development/production | Node.jsè¿è¡Œæ—¶ç¯å¢ƒå˜é‡ | ä¸­     |
| process.env.KOATTY_ENV | ä»»æ„å­—ç¬¦               | æ¡†æ¶è¿è¡Œæ—¶ç¯å¢ƒå˜é‡    | é«˜     |


è¿™é‡Œçš„ä¼˜å…ˆçº§æŒ‡åŠ è½½è¿è¡Œæ—¶ç›¸åº”é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§ã€‚

ä¾‹å¦‚ï¼š

- `process.env.KOATTY_ENV=pro`,ä¼šè‡ªåŠ¨åŠ è½½å¸¦`_pro.ts`åç¼€çš„é…ç½®æ–‡ä»¶ã€‚

- `process.env.KOATTY_ENV`æ²¡æœ‰é…ç½®ï¼Œå¦‚æœ`process.env.NODE_ENV=production`,ä¼šè‡ªåŠ¨åŠ è½½å¸¦`_production.ts`åç¼€çš„é…ç½®æ–‡ä»¶ã€‚

- å¦‚æœ`process.env.KOATTY_ENV`ä»¥åŠ`process.env.NODE_ENV`éƒ½æ²¡æœ‰é…ç½®ï¼Œåˆ™çœ‹`appDebug`çš„å€¼ï¼Œä¸ºtrueæ—¶ï¼Œ`process.env.NODE_ENV`è‡ªåŠ¨èµ‹å€¼ä¸ºdevelopmentï¼Œä¸ºfalseæ—¶èµ‹å€¼ä¸ºproductionï¼Œç›¸åº”åŠ è½½çš„é…ç½®æ–‡ä»¶ä¹Ÿéµå¾ª`_development.ts`æˆ–`_production.ts`åç¼€

é€šè¿‡å¯¹è¿™ä¸‰ä¸ªå˜é‡çš„çµæ´»é…ç½®ï¼Œå¯ä»¥æ”¯æŒå¤šæ ·åŒ–çš„è¿è¡Œç¯å¢ƒåŠé…ç½®

### å¸¸ç”¨çš„ç¯å¢ƒå˜é‡

* process.env.ROOT_PATH

Koattyå®šä¹‰çš„é¡¹ç›®æ ¹ç›®å½•ï¼Œåœ¨é¡¹ç›®ä¸­ä»»ä½•åœ°æ–¹å‡å¯ä½¿ç”¨ã€‚

* process.env.APP_PATH

Koattyå®šä¹‰çš„é¡¹ç›®åº”ç”¨ç›®å½•(è°ƒè¯•æ¨¡å¼ä¸‹å¯åŠ¨ï¼Œå€¼ä¸º/`projectDIR`/srcï¼›åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹å¯åŠ¨ï¼Œå€¼ä¸º/`projectDIR`/dist)ï¼Œåœ¨é¡¹ç›®ä¸­ä»»ä½•åœ°æ–¹å‡å¯ä½¿ç”¨ã€‚

* process.env.THINK_PATH

Koattyå®šä¹‰çš„æ¡†æ¶æ ¹ç›®å½•(/`projectDIR`/node_modules/koatty/)ï¼Œåœ¨é¡¹ç›®ä¸­ä»»ä½•åœ°æ–¹å‡å¯ä½¿ç”¨ã€‚

* process.env.LOGS_PATH

Koattyå®šä¹‰çš„æ—¥å¿—ä¿å­˜ç›®å½•(é»˜è®¤ä¸º/`projectDIR`/logsï¼Œå¯åœ¨é…ç½®ä¸­ä¿®æ”¹)ï¼Œåœ¨é¡¹ç›®ä¸­ä»»ä½•åœ°æ–¹å‡å¯ä½¿ç”¨ã€‚


## è·¯ç”±

Koatty é€šè¿‡RequestMappingç±»å‹è£…é¥°å™¨è¿›è¡Œè·¯ç”±æ³¨å†Œï¼Œä½¿ç”¨[@koa/router](https://github.com/koajs/router)è¿›è¡Œè·¯ç”±è§£æã€‚

### æ§åˆ¶å™¨è·¯ç”±

`@Controller()`è£…é¥°å™¨çš„å‚æ•°ä½œä¸ºæ§åˆ¶å™¨è®¿é—®å…¥å£ï¼Œå‚æ•°é»˜è®¤å€¼ä¸º`/`ã€‚ç„¶åå†éå†è¯¥æ§åˆ¶å™¨çš„æ–¹æ³•ä¸Šçš„è£…é¥°å™¨GetMapingã€
DeleteMapingã€PutMapingã€PostMapingç­‰è¿›è¡Œæ–¹æ³•è·¯ç”±æ³¨å†Œã€‚

ä¾‹å¦‚ï¼š
```js
@Controller("/admin")
export class AdminController extends BaseController {
    ...
    @GetMapping("/test")
    test(){
        ...
    }
    ...
}
```
ä¸Šè¿°ä»£ç æ³¨å†Œäº†è·¯ç”± `/admin/test` ==> AdminController.test();

### æ–¹æ³•è·¯ç”±

ç”¨äºæ§åˆ¶å™¨æ–¹æ³•ç»‘å®šè·¯ç”± [å‚è€ƒè£…é¥°å™¨ç« èŠ‚](##MethodDecoratoræ–¹æ³•è£…é¥°å™¨)

æ–¹æ³•è·¯ç”±çš„è£…é¥°å™¨æœ‰ `GetMapping`ã€`PostMapping`ã€`DeleteMapping`ã€`PutMapping`ã€`PatchMapping`ã€`OptionsMapping`ã€`HeadMapping`

### è·¯ç”±é…ç½®

åœ¨é¡¹ç›® src/config/router.tså­˜æ”¾ç€è·¯ç”±è‡ªå®šä¹‰é…ç½®ï¼Œè¯¥é…ç½®ç”¨äºåˆå§‹åŒ–`@koa/router`å®ä¾‹ï¼Œä½œä¸º**æ„é€ æ–¹æ³•å…¥å‚**ä½¿ç”¨ï¼Œå…·ä½“é…ç½®é¡¹è¯·å‚è€ƒ [@koa/router](https://github.com/koajs/router)ã€‚

```js
    prefix: string;
    /**
     * Methods which should be supported by the router.
     */
    methods ?: string[];
    routerPath ?: string;
    /**
     * Whether or not routing should be case-sensitive.
     */
    sensitive ?: boolean;
    /**
     * Whether or not routes should matched strictly.
     *
     * If strict matching is enabled, the trailing slash is taken into
     * account when matching routes.
     */
    strict ?: boolean;
```

### è·¯ç”±ç‰¹ç‚¹

* @Controller()è£…é¥°å™¨æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œä¸€æ˜¯å£°æ˜beançš„ç±»å‹æ˜¯æ§åˆ¶å™¨ï¼›äºŒæ˜¯ç»‘å®šæ§åˆ¶å™¨è·¯ç”±ã€‚å¦‚æœä½¿ç”¨@Controller()è£…é¥°å™¨çš„æ—¶å€™æ²¡æœ‰æŒ‡å®špath(æ²¡æœ‰å‚æ•°)ï¼Œé»˜è®¤å‚æ•°å€¼ä¸º"/"

* è·¯ç”±è£…é¥°å™¨ï¼ˆåŒ…æ‹¬`RequestMapping`ã€`GetMapping`ã€`PostMapping`ã€`DeleteMapping`ã€`PutMapping`ã€`PatchMapping`ã€`OptionsMapping`ã€`HeadMapping`ï¼‰ä»…å¯ç”¨äºè£…é¥°æ§åˆ¶å™¨ç±»çš„æ–¹æ³•ã€‚

* è·¯ç”±è£…é¥°å™¨ï¼ˆåŒ…æ‹¬`RequestMapping`ã€`GetMapping`ã€`PostMapping`ã€`DeleteMapping`ã€`PutMapping`ã€`PatchMapping`ã€`OptionsMapping`ã€`HeadMapping`ï¼‰å¯ä»¥ç»™åŒä¸€ä¸ªæ–¹æ³•æ·»åŠ å¤šæ¬¡ã€‚ä½†æ˜¯@Controller()è£…é¥°å™¨åŒä¸€ä¸ªç±»ä»…èƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚

* å¦‚æœç»‘å®šçš„è·¯ç”±å­˜åœ¨é‡å¤ï¼ŒæŒ‰ç…§IOCå®¹å™¨ä¸­æ§åˆ¶å™¨ç±»çš„åŠ è½½é¡ºåºï¼Œç¬¬ä¸€ä¸ªåŠ è½½çš„è·¯ç”±è§„åˆ™ç”Ÿæ•ˆã€‚éœ€è¦æ³¨æ„æ­¤ç±»é—®é¢˜ã€‚åœ¨åç»­ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šå¢åŠ ä¼˜å…ˆçº§çš„ç‰¹æ€§æ¥æ§åˆ¶ã€‚

* è·¯ç”±æ”¯æŒæ­£åˆ™ï¼Œæ”¯æŒå‚æ•°ç»‘å®šã€‚è¯¦ç»†è·¯ç”±ç›¸å…³æ•™ç¨‹è¯·å‚è€ƒ [@koa/router](https://github.com/koajs/router) 


## ä¸­é—´ä»¶

Koattyæ˜¯åŸºäº Koa å®ç°çš„ï¼Œæ‰€ä»¥ Koatty çš„ä¸­é—´ä»¶å½¢å¼å’Œ Koa çš„ä¸­é—´ä»¶å½¢å¼æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯åŸºäºæ´‹è‘±åœˆæ¨¡å‹ã€‚æ¯æ¬¡æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªä¸­é—´ä»¶ï¼Œå°±ç›¸å½“äºåœ¨æ´‹è‘±å¤–é¢åŒ…äº†ä¸€å±‚ã€‚

Koattyæ¡†æ¶é»˜è®¤åŠ è½½äº†staticã€payloadç­‰ä¸­é—´ä»¶ï¼Œèƒ½å¤Ÿæ»¡è¶³å¤§éƒ¨åˆ†çš„Webåº”ç”¨åœºæ™¯ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥è‡ªè¡Œå¢åŠ ä¸­é—´ä»¶è¿›è¡Œæ‰©å±•ã€‚

Koattyä¸­é—´ä»¶ç±»å¿…é¡»ä½¿ç”¨`@Middleware`æ¥å£°æ˜ï¼Œè¯¥ç±»å¿…é¡»è¦åŒ…å«åä¸º`run(options: any, app: App)`çš„æ–¹æ³•ã€‚è¯¥æ–¹æ³•åœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™ä¼šè¢«è°ƒç”¨æ‰§è¡Œï¼Œå¹¶ä¸”è¿”å›å€¼æ˜¯ä¸€ä¸ª`function (ctx: any, next: any){}`ï¼Œè¿™ä¸ªfunctionæ˜¯Koaä¸­é—´ä»¶çš„æ ¼å¼ã€‚

### ä½¿ç”¨ä¸­é—´ä»¶

ä¸­é—´ä»¶ä¸€èˆ¬é€šè¿‡ npm æ¨¡å—çš„æ–¹å¼è¿›è¡Œå¤ç”¨ï¼š

```bash
npm i think_jwt --save
```
æ³¨æ„ï¼šæˆ‘ä»¬å»ºè®®é€šè¿‡ ^ çš„æ–¹å¼å¼•å…¥ä¾èµ–ï¼Œå¹¶ä¸”å¼ºçƒˆä¸å»ºè®®é”å®šç‰ˆæœ¬ã€‚

```js
{
  "dependencies": {
    "think_jwt": "^1.0.0"
  }
}
```

ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·koatty_cliï¼Œåœ¨å‘½ä»¤è¡Œæ‰§è¡Œå‘½ä»¤:

```bash
//jwt ä¸ºè‡ªå®šä¹‰ä¸­é—´ä»¶å
koatty middleware jwt
```
ä¼šè‡ªåŠ¨åœ¨é¡¹ç›®ç›®å½•ç”Ÿæˆæ–‡ä»¶ src/middleware/JwtMiddleware.ts

ç”Ÿæˆçš„ä¸­é—´ä»¶ä»£ç æ¨¡æ¿: 

```js

/**
 * Middleware
 * @return
 */

import { Middleware, Helper } from "koatty";
import { App } from '../App';
import jwt from "think_jwt";

@Middleware()
export class JwtMiddleware implements IMiddleware {
    run(options: any, app: App) {
        return jwt(options, app);
    }
}
```

ä¿®æ”¹é¡¹ç›®ä¸­é—´ä»¶é…ç½® src/config/middleware.ts

```js
list: ['JwtMiddleware'], //åŠ è½½çš„ä¸­é—´ä»¶åˆ—è¡¨
config: { //ä¸­é—´ä»¶é…ç½® 
	JwtMiddleware: {
		//ä¸­é—´ä»¶é…ç½®é¡¹
	}
}

```
### ç¦ç”¨ä¸­é—´ä»¶

å¯¹äºé¡¹ç›®ä¸­è‡ªè¡Œå¼€å‘ä¸­é—´ä»¶ï¼Œå¦‚æœè¦ç¦ç”¨ï¼Œåªéœ€è¦ä¿®æ”¹ä¸­é—´ä»¶é…ç½®æ–‡ä»¶å³å¯:

src/config/middleware.ts

```js
list: [], //åˆ—è¡¨ä¸­æ²¡æœ‰PassportMiddlewareï¼Œå› æ­¤Passportä¸­é—´ä»¶ä¸ä¼šæ‰§è¡Œ
config: { //ä¸­é—´ä»¶é…ç½® 
	'PassportMiddleware': false, // ä¸­é—´ä»¶é…ç½®ä¸ºfalseï¼Œä¸­é—´ä»¶ä¹Ÿä¸ä¼šæ‰§è¡Œ
}
```

å¯¹äºKoattyé»˜è®¤æ‰§è¡Œçš„ä¸­é—´ä»¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç¦æ­¢å®ƒä»¬æ‰§è¡Œï¼ˆä¸€èˆ¬ä¸å»ºè®®ï¼‰:

```js
list: [], 
config: { //ä¸­é—´ä»¶é…ç½® 
	'StaticMiddleware': false //Staticä¸­é—´ä»¶è¢«é…ç½®ä¸ºä¸æ‰§è¡Œ
}
```

### ä½¿ç”¨koaä¸­é—´ä»¶

Koattyæ”¯æŒä½¿ç”¨koaçš„ä¸­é—´ä»¶ï¼ˆåŒ…æ‹¬koa1.xåŠ2.xçš„ä¸­é—´ä»¶ï¼‰ï¼š

src/middleware/Passport.ts

```js
const passport = require('koa-passport');


@Middleware()
export class PassportMiddleware implements IMiddleware {
    run(options: any, app: App) {
        return passport.initialize();
    }
}

```
æŒ‚è½½å¹¶é…ç½®ä½¿ç”¨ï¼š 

src/config/middleware.ts

```js
list: ['PassportMiddleware'], //åŠ è½½çš„ä¸­é—´ä»¶åˆ—è¡¨
config: { //ä¸­é—´ä»¶é…ç½® 
	'PassportMiddleware': {
		//ä¸­é—´ä»¶é…ç½®é¡¹
	}
}
```

## æ§åˆ¶å™¨

Koattyæ§åˆ¶å™¨ç±»ä½¿ç”¨`@Controller()`è£…é¥°å™¨å£°æ˜ï¼Œè¯¥è£…é¥°å™¨çš„å…¥å‚ç”¨äºç»‘å®šæ§åˆ¶å™¨è®¿é—®è·¯ç”±ï¼Œå‚æ•°é»˜è®¤å€¼ä¸º`\/`ã€‚æ§åˆ¶å™¨ç±»é»˜è®¤æ”¾åœ¨é¡¹ç›®çš„`src/controller`æ–‡ä»¶å¤¹å†…ï¼Œæ”¯æŒä½¿ç”¨å­æ–‡ä»¶å¤¹è¿›è¡Œå½’ç±»ã€‚Koattyæ§åˆ¶å™¨ç±»å¿…é¡»ç»§æ‰¿`BaseController`æˆ–`BaseController`çš„å­ç±»(`RestController`æˆ–å…¶ä»–è‡ªå®šä¹‰å­ç±»)ã€‚

### åˆ›å»ºæ§åˆ¶å™¨

ä½¿ç”¨koatty_cliå‘½ä»¤è¡Œå·¥å…·ï¼š

å•æ¨¡å—æ¨¡å¼ï¼š

```bash
koatty controller index
```

ä¼šè‡ªåŠ¨åˆ›å»º src/controller/Index.tsæ–‡ä»¶ã€‚

å¤šæ¨¡å—æ¨¡å¼ï¼š


```bash
think controller admin/index
```

ä¼šè‡ªåŠ¨åˆ›å»º src/controller/Admin/Index.tsæ–‡ä»¶ã€‚


æ§åˆ¶å™¨æ¨¡æ¿ä»£ç å¦‚ä¸‹ï¼š

```js
import { Controller, BaseController, GetMapping } from "koatty";
import { App } from '../App';

@Controller("/")
export class IndexController extends BaseController {
    app: App;

    /**
     * Custom constructor
     *
     */
    init() {
        //...
    }

    @GetMapping("/")
    index() {
        return this.ok('Hello, Koatty!');
    }
}
```
### æ§åˆ¶å™¨ç‰¹ç‚¹

æ§åˆ¶å™¨ç±»å¿…é¡»ç»§æ‰¿äº BaseController æˆ– BaseController çš„å­ç±»ã€‚

Koatty ä½¿ç”¨`init()` æ–¹æ³•æ¥æ›¿ä»£`construct()` æ„é€ æ–¹æ³•(constructåœ¨ä½¿ç”¨superæ—¶æœ‰é™åˆ¶)ã€‚

æ§åˆ¶å™¨é‡Œå¯ä»¥é‡å†™ `init` æ–¹æ³•å¦‚ï¼š

```js

init(){
    this.data = {};
}
```
### è®¿é—®æ§åˆ¶

ç±»ä¹‹é—´çš„å¼•ç”¨éµå¾ªTypescriptçš„ä½œç”¨åŸŸ private | protected | publicï¼Œ å¦‚æœæœªæ˜¾å¼å£°æ˜ï¼Œç±»æ–¹æ³•çš„ä½œç”¨åŸŸä¸ºpublicã€‚

åªè¦ç»™æ§åˆ¶å™¨ç±»æ–¹æ³•ç»‘å®šäº†è·¯ç”±(é€šè¿‡è·¯ç”±è£…é¥°å™¨)ï¼Œé‚£ä¹ˆæ–¹æ³•å³å¯è¢«urlæ˜ å°„è®¿é—®ï¼Œè€Œä¸ç®¡è¯¥æ–¹æ³•æ˜¯å¦æ˜¯publicã€‚è¿™æ˜¯å› ä¸ºç›®å‰é€šè¿‡åå°„æ— æ³•è·å–åˆ°æ–¹æ³•çš„ä½œç”¨åŸŸå…³é”®å­—(æœ‰çŸ¥é“çš„è¯·å‘Šè¯‰æˆ‘ğŸ˜)ã€‚

### æ§åˆ¶å™¨å±æ€§åŠæ–¹æ³•

æ§åˆ¶å™¨å±æ€§åŠæ–¹æ³•è¯·å‚è€ƒ[API](##BaseController)

### RESTfulæ§åˆ¶å™¨

é€šè¿‡ç»§æ‰¿`RestController`å³å¯å¿«é€Ÿå®ç°ä¸€ä¸ªRESTfulé£æ ¼çš„æ§åˆ¶å™¨:

```js
import { Controller, BaseController, GetMapping } from "koatty";
import { App } from '../App';

@Controller("/")
export class IndexController extends RestController {
    app: App;

    __before() {
        //ä½¿ç”¨__beforeåˆ‡é¢å®ç°è®¿é—®æƒé™æ§åˆ¶

    }
}
```

å½“GETæ–¹å¼è®¿é—®pathè·¯ç”±`/user/1`ï¼Œæ§åˆ¶å™¨ä¼šè‡ªåŠ¨æŸ¥è¯¢UserModelå¯¹åº”å®ä½“å†…çš„IDä¸º1çš„èµ„æºã€‚


## æœåŠ¡å±‚

ç®€å•æ¥è¯´ï¼ŒService å°±æ˜¯åœ¨å¤æ‚ä¸šåŠ¡åœºæ™¯ä¸‹ç”¨äºåšä¸šåŠ¡é€»è¾‘å°è£…çš„ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œæä¾›è¿™ä¸ªæŠ½è±¡æœ‰ä»¥ä¸‹å‡ ä¸ªå¥½å¤„ï¼š

* ä¿æŒ Controller ä¸­çš„é€»è¾‘æ›´åŠ ç®€æ´ã€‚
* ä¿æŒä¸šåŠ¡é€»è¾‘çš„ç‹¬ç«‹æ€§ï¼ŒæŠ½è±¡å‡ºæ¥çš„ Service å¯ä»¥è¢«å¤šä¸ª Controller é‡å¤è°ƒç”¨ã€‚
* å°†é€»è¾‘å’Œå±•ç°åˆ†ç¦»ï¼Œæ›´å®¹æ˜“ç¼–å†™æµ‹è¯•ç”¨ä¾‹

Koattyä¸­æœåŠ¡ç±»ä½¿ç”¨`@Service()`è£…é¥°å™¨å£°æ˜ã€‚æœåŠ¡ç±»é»˜è®¤æ”¾åœ¨é¡¹ç›®çš„`src/service`æ–‡ä»¶å¤¹å†…ï¼Œæ”¯æŒä½¿ç”¨å­æ–‡ä»¶å¤¹è¿›è¡Œå½’ç±»ã€‚Koattyæ§åˆ¶å™¨ç±»å¿…é¡»ç»§æ‰¿`BaseService`åŸºç±»æˆ–`BaseService`çš„å­ç±»ã€‚

### åˆ›å»ºæœåŠ¡ç±»

ä½¿ç”¨koatty_cliå‘½ä»¤è¡Œå·¥å…·ï¼š

```bash
koatty service test
```

ä¼šè‡ªåŠ¨åˆ›å»ºsrc/service/test.js,ç”Ÿæˆçš„æ¨¡æ¿ä»£ç ï¼š

```js
import { Service, BaseService, Autowired, Scheduled, Cacheable } from "koatty";
import { App } from '../App';

@Service()
export class TestService extends BaseService  {
    app: App;

    init() {
        //property
    }

    //å®ç°testæ–¹æ³•
    test(name: string) {
        return name;
    }
}
```

### ä½¿ç”¨æœåŠ¡ç±»

é€šè¿‡è£…é¥°å™¨æ³¨å…¥:

```js
@Autowired()
testService: TestService;
```

é€šè¿‡IOCå®¹å™¨è·å–:

```js
this.testService = this.app.Container.get("TestService", "SERVICE");
```

è°ƒç”¨æœåŠ¡ç±»æ–¹æ³•ï¼š

```js
this.testService.test();
```

## æŒä¹…å±‚

é€šè¿‡ä½¿ç”¨`koatty_cli`å·¥å…·ï¼Œkoattyç›®å‰é»˜è®¤æ”¯æŒä¸¤ç§ORMæ¡†æ¶ï¼Œåˆ†åˆ«æ˜¯ThinkORMä»¥åŠTypeORMã€‚å¦‚éœ€ä½¿ç”¨å…¶ä»–ç±»å‹çš„ORMï¼Œä¾‹å¦‚sequelizeã€mongoseç­‰ï¼Œéœ€è¦è‡ªè¡Œå®ç°ï¼Œkoattyå¹¶ä¸åšé™åˆ¶ã€‚

### åˆ›å»ºæ•°æ®å®ä½“

é€šè¿‡koatty_cliå‘½ä»¤è¡Œå·¥å…·åˆ›å»ºæ•°æ®å®ä½“:

```shell
// default is thinkorm
koatty model test

//typeorm
koatty model --orm test
```

è¯¥å·¥å…·ä¼šè‡ªåŠ¨åˆ›å»ºå®ä½“ç±»ã€‚å¦‚æœä½¿ç”¨TypeORMï¼Œå·¥å…·é™¤å®ä½“ç±»ä»¥å¤–ï¼Œè¿˜ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªä¸­é—´ä»¶ï¼Œéœ€è¦ä¿®æ”¹src/config/middleware.tsä¸­çš„ä¸­é—´ä»¶é…ç½®é¡¹è¿›è¡Œé…ç½®ã€‚

## æ’ä»¶

æ’ä»¶æœºåˆ¶æ˜¯åœ¨ä¿è¯æ¡†æ¶æ ¸å¿ƒçš„è¶³å¤Ÿç²¾ç®€ã€ç¨³å®šçš„å‰æä¸‹ï¼Œå¯¹æ¡†æ¶è¿›è¡Œåº•å±‚æ‰©å±•ã€‚

### ä¸ºä»€ä¹ˆéœ€è¦æ’ä»¶

æˆ‘ä»¬åœ¨ä½¿ç”¨ä¸­é—´ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°ä¸€äº›é—®é¢˜ï¼š

* ä¸­é—´ä»¶çš„å®šä½æ˜¯æ‹¦æˆªç”¨æˆ·è¯·æ±‚ï¼Œå¹¶åœ¨å®ƒå‰ååšä¸€äº›äº‹æƒ…ï¼Œä¾‹å¦‚ï¼šé‰´æƒã€å®‰å…¨æ£€æŸ¥ã€è®¿é—®æ—¥å¿—ç­‰ç­‰ã€‚ä½†å®é™…æƒ…å†µæ˜¯ï¼Œæœ‰äº›åŠŸèƒ½æ˜¯å’Œè¯·æ±‚æ— å…³çš„ï¼Œä¾‹å¦‚ï¼šå®šæ—¶ä»»åŠ¡ã€æ¶ˆæ¯è®¢é˜…ã€åå°é€»è¾‘ç­‰ç­‰ã€‚

* æœ‰äº›åŠŸèƒ½åŒ…å«éå¸¸å¤æ‚çš„åˆå§‹åŒ–é€»è¾‘ï¼Œéœ€è¦åœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™å®Œæˆã€‚è¿™æ˜¾ç„¶ä¹Ÿä¸é€‚åˆæ”¾åˆ°ä¸­é—´ä»¶ä¸­å»å®ç°ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬éœ€è¦ä¸€å¥—æ›´åŠ å¼ºå¤§çš„æœºåˆ¶ï¼Œæ¥ç®¡ç†ã€ç¼–æ’é‚£äº›ç›¸å¯¹ç‹¬ç«‹çš„ä¸šåŠ¡é€»è¾‘ã€‚å…¸å‹çš„åº”ç”¨åœºæ™¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒæ³¨å†Œã€å‘é…ç½®ä¸­å¿ƒæ‹‰å–é…ç½®ç­‰ã€‚


### åˆ›å»ºæ’ä»¶

æ’ä»¶ä¸€èˆ¬é€šè¿‡ npm æ¨¡å—çš„æ–¹å¼è¿›è¡Œå¤ç”¨ï¼š

```shell
npm i koatty_apollo --save
```
æ³¨æ„ï¼šæˆ‘ä»¬å»ºè®®é€šè¿‡ ^ çš„æ–¹å¼å¼•å…¥ä¾èµ–ï¼Œå¹¶ä¸”å¼ºçƒˆä¸å»ºè®®é”å®šç‰ˆæœ¬ã€‚

```js
{
  "dependencies": {
    "koatty_apollo": "^1.0.0"
  }
}
```

ä½¿ç”¨`koatty_cli`åœ¨åº”ç”¨ä¸­åˆ›å»ºä¸€ä¸ªæ’ä»¶ç±»:

```shell
koatty plugin apollo
```
ç”Ÿæˆçš„æ’ä»¶ä»£ç æ¨¡æ¿: 

```js
import { Plugin, IPlugin } from 'koatty';
import { App } from '../App';
import { Apollo } from 'koatty_apollo';

@Plugin()
export class ApolloPlugin implements IPlugin {
  run(options: any, app: App) {
    return Apollo(options, app);
  }
}

```

ç„¶åéœ€è¦åœ¨åº”ç”¨çš„ config/plugin.ts ä¸­å£°æ˜ï¼š

```js
list: ['ApolloPlugin'], //åŠ è½½çš„æ’ä»¶åˆ—è¡¨
config: { //æ’ä»¶é…ç½® 
	'ApolloPlugin': {
		//æ’ä»¶é…ç½®é¡¹
	}
}
```
### ç¦ç”¨æ’ä»¶

å¯¹äºé¡¹ç›®ä¸­æ’ä»¶ï¼Œå¦‚æœè¦ç¦ç”¨ï¼Œåªéœ€è¦ä¿®æ”¹æ’ä»¶é…ç½®æ–‡ä»¶å³å¯:

src/config/plugin.ts

```js
list: [], //åˆ—è¡¨ä¸­æ²¡æœ‰ApolloPluginï¼Œå› æ­¤ApolloPluginæ’ä»¶ä¸ä¼šæ‰§è¡Œ

config: { //æ’ä»¶é…ç½® 
	'ApolloPlugin': false,  // æ’ä»¶é…ç½®ä¸ºfalseï¼ŒApolloPluginæ’ä»¶ä¹Ÿä¸ä¼šæ‰§è¡Œ
}

```
# è¿›é˜¶åº”ç”¨

## æ¶æ„

![test image size](./assets/Koatty.png)

Koattyåœ¨Koa2çš„åŸºç¡€ä¸Šè¿›è¡Œäº†å°è£…å’Œæ‰©å±•ï¼Œæ–¹ä¾¿è¿›è¡Œå¿«é€Ÿå¼€å‘ï¼›å¹¶ä¸”ä¿æŒå‘ä¸‹å…¼å®¹Koaçš„åŸç”Ÿç”¨æ³•ï¼ŒKoaçš„ä¸­é—´ä»¶ä»…éœ€è¿›è¡Œç®€å•åŒ…è£…å³å¯åœ¨Koattyä¸­ä½¿ç”¨ã€‚

Koattyå‚è€ƒ SpringBootè®¾è®¡å®ç°IOCå®¹å™¨ï¼Œå…·å¤‡è‡ªåŠ¨åŠ è½½ã€è‡ªåŠ¨ä¾èµ–ç®¡ç†ç­‰ç‰¹æ€§ï¼Œå¹¶ä¸”åˆ©ç”¨å»¶è¿ŸåŠ è½½æœºåˆ¶é¿å…å¾ªç¯ä¾èµ–ï¼›åœ¨ä½¿ç”¨æ–¹æ³•ä¸Šè´´è¿‘SpringBootçš„å¼€å‘ä¹ æƒ¯ï¼Œæœ‰æ•ˆçš„é™ä½äº†å…¥é—¨é—¨æ§›ã€‚

## IOCå®¹å™¨

IoCå…¨ç§°Inversion of Controlï¼Œç›´è¯‘ä¸ºæ§åˆ¶åè½¬ã€‚åœ¨ä»¥ES6 ClassèŒƒå¼ç¼–ç¨‹ä¸­ï¼Œç®€å•çš„é€šè¿‡newåˆ›å»ºå®ä¾‹å¹¶æŒæœ‰çš„æ–¹å¼ï¼Œä¼šå‘ç°ä»¥ä¸‹ç¼ºç‚¹ï¼š

* å®ä¾‹åŒ–ä¸€ä¸ªç»„ä»¶ï¼Œè¦å…ˆå®ä¾‹åŒ–ä¾èµ–çš„ç»„ä»¶ï¼Œå¼ºè€¦åˆ

* æ¯ä¸ªç»„ä»¶éƒ½éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ªä¾èµ–ç»„ä»¶ï¼Œæ²¡æœ‰å¤ç”¨

* å¾ˆå¤šç»„ä»¶éœ€è¦é”€æ¯ä»¥ä¾¿é‡Šæ”¾èµ„æºï¼Œä¾‹å¦‚DataSourceï¼Œä½†å¦‚æœè¯¥ç»„ä»¶è¢«å¤šä¸ªç»„ä»¶å…±äº«ï¼Œå¦‚ä½•ç¡®ä¿å®ƒçš„ä½¿ç”¨æ–¹éƒ½å·²ç»å…¨éƒ¨è¢«é”€æ¯

* éšç€æ›´å¤šçš„ç»„ä»¶è¢«å¼•å…¥ï¼Œéœ€è¦å…±äº«çš„ç»„ä»¶å†™èµ·æ¥ä¼šæ›´å›°éš¾ï¼Œè¿™äº›ç»„ä»¶çš„ä¾èµ–å…³ç³»ä¼šè¶Šæ¥è¶Šå¤æ‚


å¦‚æœä¸€ä¸ªç³»ç»Ÿæœ‰å¤§é‡çš„ç»„ä»¶ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸå’Œç›¸äº’ä¹‹é—´çš„ä¾èµ–å…³ç³»å¦‚æœç”±ç»„ä»¶è‡ªèº«æ¥ç»´æŠ¤ï¼Œä¸ä½†å¤§å¤§å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œè€Œä¸”ä¼šå¯¼è‡´ç»„ä»¶ä¹‹é—´æä¸ºç´§å¯†çš„è€¦åˆï¼Œç»§è€Œç»™æµ‹è¯•å’Œç»´æŠ¤å¸¦æ¥äº†æå¤§çš„å›°éš¾ã€‚

å› æ­¤ï¼Œæ ¸å¿ƒé—®é¢˜æ˜¯ï¼š

- 1ã€è°è´Ÿè´£åˆ›å»ºç»„ä»¶ï¼Ÿ
- 2ã€è°è´Ÿè´£æ ¹æ®ä¾èµ–å…³ç³»ç»„è£…ç»„ä»¶ï¼Ÿ
- 3ã€é”€æ¯æ—¶ï¼Œå¦‚ä½•æŒ‰ä¾èµ–é¡ºåºæ­£ç¡®é”€æ¯ï¼Ÿ

è§£å†³è¿™ä¸€é—®é¢˜çš„æ ¸å¿ƒæ–¹æ¡ˆå°±æ˜¯IoCã€‚å‚è€ƒSpring IOCçš„å®ç°æœºåˆ¶ï¼ŒKoattyå®ç°äº†ä¸€ä¸ªIOCå®¹å™¨ï¼ˆkoatty_containerï¼‰ï¼Œåœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™ï¼Œè‡ªåŠ¨åˆ†ç±»è£…è½½ç»„ä»¶ï¼Œå¹¶ä¸”æ ¹æ®ä¾èµ–å…³ç³»ï¼Œæ³¨å…¥ç›¸åº”çš„ä¾èµ–ã€‚å› æ­¤ï¼ŒIoCåˆç§°ä¸ºä¾èµ–æ³¨å…¥ï¼ˆDIï¼šDependency Injectionï¼‰ï¼Œå®ƒè§£å†³äº†ä¸€ä¸ªæœ€ä¸»è¦çš„é—®é¢˜ï¼šå°†ç»„ä»¶çš„åˆ›å»º+é…ç½®ä¸ç»„ä»¶çš„ä½¿ç”¨ç›¸åˆ†ç¦»ï¼Œå¹¶ä¸”ï¼Œç”±IoCå®¹å™¨è´Ÿè´£ç®¡ç†ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚

### ç»„ä»¶åˆ†ç±»

æ ¹æ®ç»„ä»¶çš„ä¸åŒåº”ç”¨åœºæ™¯ï¼ŒKoattyæŠŠBeanåˆ†ä¸º 'COMPONENT' | 'CONTROLLER' | 'MIDDLEWARE' | 'SERVICE' å››ç§ç±»å‹ã€‚

* COMPONENT
  æ‰©å±•ç±»ã€ç¬¬ä¸‰æ–¹ç±»å±äºæ­¤ç±»å‹ï¼Œä¾‹å¦‚ Pluginï¼ŒORMæŒä¹…å±‚ç­‰

* CONTROLLER
  æ§åˆ¶å™¨ç±»

* MIDDLEWARE
  ä¸­é—´ä»¶ç±»

* SERVICE
  é€»è¾‘æœåŠ¡ç±»

### ç»„ä»¶åŠ è½½

é€šè¿‡Koattyæ¡†æ¶æ ¸å¿ƒçš„Loaderï¼Œåœ¨é¡¹ç›®å¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ†æå¹¶è£…é…Beanï¼Œè‡ªåŠ¨å¤„ç†å¥½Beanä¹‹é—´çš„ä¾èµ–é—®é¢˜ã€‚IOCå®¹å™¨æä¾›äº†ä¸€ç³»åˆ—çš„[APIæ¥å£](#IOCContainer)ï¼Œæ–¹ä¾¿æ³¨å†Œä»¥åŠè·å–è£…é…å¥½çš„Beanã€‚

## AOPåˆ‡é¢

KoattyåŸºäºIOCå®¹å™¨å®ç°äº†ä¸€å¥—åˆ‡é¢ç¼–ç¨‹æœºåˆ¶ï¼Œåˆ©ç”¨è£…é¥°å™¨ä»¥åŠå†…ç½®ç‰¹æ®Šæ–¹æ³•ï¼Œåœ¨beanè£…è½½åˆ°IOCå®¹å™¨å†…çš„æ—¶å€™ï¼Œé€šè¿‡åµŒå¥—å‡½æ•°çš„åŸç†è¿›è¡Œå°è£…ï¼Œç®€å•è€Œä¸”é«˜æ•ˆã€‚

### åˆ‡ç‚¹å£°æ˜ç±»å‹

* è£…é¥°å™¨å£°æ˜
  é€šè¿‡@Beforeã€@Afterã€@BeforeEachã€@AfterEachè£…é¥°å™¨å£°æ˜çš„åˆ‡ç‚¹

* å†…ç½®æ–¹æ³•å£°æ˜
  é€šè¿‡__beforeã€__after å†…ç½®éšè—æ–¹æ³•å£°æ˜çš„åˆ‡ç‚¹

ä¸¤ç§å£°æ˜æ–¹å¼çš„åŒºåˆ«:

| å£°æ˜æ–¹å¼     | ä¾èµ–Aspectåˆ‡é¢ç±» | èƒ½å¦ä½¿ç”¨ç±»ä½œç”¨åŸŸ | å…¥å‚ä¾èµ–åˆ‡ç‚¹æ–¹æ³• |
| ------------ | ---------------- | ---------------- | ---------------- |
| è£…é¥°å™¨å£°æ˜   | ä¾èµ–             | ä¸èƒ½             | ä¾èµ–             |
| å†…ç½®æ–¹æ³•å£°æ˜ | ä¸ä¾èµ–           | èƒ½               | ä¸ä¾èµ–           |

ä¾èµ–Aspectåˆ‡é¢ç±»ï¼š éœ€è¦åˆ›å»ºå¯¹åº”çš„Aspectåˆ‡é¢ç±»æ‰èƒ½ä½¿ç”¨

èƒ½å¦ä½¿ç”¨ç±»ä½œç”¨åŸŸï¼š èƒ½ä¸èƒ½ä½¿ç”¨åˆ‡ç‚¹æ‰€åœ¨ç±»çš„thisæŒ‡é’ˆ

å…¥å‚ä¾èµ–åˆ‡ç‚¹æ–¹æ³•ï¼š è£…é¥°å™¨å£°æ˜åˆ‡ç‚¹æ‰€åœ¨æ–¹æ³•çš„å…¥å‚åŒåˆ‡é¢å…±äº«ï¼Œå†…ç½®æ–¹æ³•å£°æ˜çš„åˆ‡ç‚¹å› ä¸ºå¯ä»¥ä½¿ç”¨thisï¼Œç†è®ºä¸Šèƒ½è·å–åˆ‡ç‚¹æ‰€åœ¨ç±»çš„ä»»ä½•å±æ€§ï¼Œæ›´åŠ çµæ´»

ä¾‹å¦‚: 

```js
@Controller('/')
export class TestController extends BaseController {
  app: App;
  ctx: KoattyContext;

  @Autowired()
  protected TestService: TestService;

  // ä¸ä¾èµ–åˆ‡é¢ç±»
  async __before(): Promise<any> { // ä¸ä¾èµ–å…·ä½“æ–¹æ³•çš„å…¥å‚ï¼Œè‡ªè¡Œé€šè¿‡thisæŒ‡é’ˆè·å–
      console.log(this.app)  // å¯ä»¥ä½¿ç”¨ç±»ä½œç”¨åŸŸï¼Œé€šè¿‡thisæŒ‡é’ˆè·å–å½“å‰ç±»å±æ€§
      console.log(this.ctx)
  }

  @Before(TestAspect) //ä¾èµ–TestAspectåˆ‡é¢ç±», èƒ½å¤Ÿè·å–pathå‚æ•°
  async test(path: string){

  }
}

```

### åˆ›å»ºåˆ‡é¢ç±»

ä½¿ç”¨`koatty_cli`è¿›è¡Œåˆ›å»ºï¼š

```bash
koatty aspect test
```

è‡ªåŠ¨ç”Ÿæˆçš„æ¨¡æ¿ä»£ç :

```js 
import { Aspect } from "koatty";
import { App } from '../App';

@Aspect()
export class TestAspect {
    app: App;

    run() {
        console.log('TestAspect');
    }
}
```

## å¯åŠ¨è‡ªå®šä¹‰

è£…é¥°å™¨`@Bootstrap`çš„ä½œç”¨æ˜¯å£°æ˜çš„é¡¹ç›®å…¥å£ç±»ï¼Œè¯¥è£…é¥°å™¨æ”¯æŒä¼ å…¥ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæ­¤å‡½æ•°åœ¨é¡¹ç›®å¯åŠ¨æ—¶ä¼šå…ˆæ‰§è¡Œã€‚

```js
@Bootstrap(
    //bootstrap function
    (app: any) => {
        // todo
    }
)
```
å¸¸è§çš„åº”ç”¨åœºæ™¯æ˜¯å¯åŠ¨ä¹‹å‰å¤„ç†ä¸€äº›è¿è¡Œç¯å¢ƒè®¾ç½®ï¼Œä¾‹å¦‚NODE_ENVç­‰ã€‚å¯åŠ¨å‡½æ•°æ”¯æŒå¼‚æ­¥ã€‚


## è£…è½½è‡ªå®šä¹‰

é¡¹ç›®å…¥å£ç±»è¿˜å¯ä»¥è®¾ç½®å¦å¤–ä¸¤ä¸ªè£…é¥°å™¨ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š

* @ComponentScan('./')
  å£°æ˜é¡¹ç›®ç»„ä»¶çš„ç›®å½•ï¼Œé»˜è®¤ä¸ºé¡¹ç›®srcç›®å½•ï¼Œå«æ‰€æœ‰çš„ç»„ä»¶ç±»å‹

* @ConfiguationScan('./config')
  å£°æ˜é¡¹ç›®çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œé»˜è®¤ä¸ºsrc/configç›®å½•

## è£…é¥°å™¨

### ç±»è£…é¥°å™¨

| è£…é¥°å™¨åç§°                                        | å‚æ•°                                                                        | è¯´æ˜                                                                                                                    | å¤‡æ³¨                                                      |
| ------------------------------------------------- | --------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------- |
| `@Aspect(identifier?: string)`                    | `identifier` æ³¨å†Œåˆ°IOCå®¹å™¨çš„æ ‡è¯†ï¼Œé»˜è®¤å€¼ä¸ºç±»åã€‚                            | å£°æ˜å½“å‰ç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»ã€‚åˆ‡é¢ç±»åœ¨åˆ‡ç‚¹æ‰§è¡Œï¼Œåˆ‡é¢ç±»å¿…é¡»å®ç°runæ–¹æ³•ä¾›åˆ‡ç‚¹è°ƒç”¨                                               | ä»…ç”¨äºåˆ‡é¢ç±»                                              |
| `@Bootstrap([bootFunc])`                          | `bootFunc` åº”ç”¨å¯åŠ¨å‰æ‰§è¡Œå‡½æ•°ã€‚å…·ä½“æ‰§è¡Œæ—¶æœºæ˜¯åœ¨app.on("appReady")äº‹ä»¶è§¦å‘ã€‚ | å£°æ˜å½“å‰ç±»æ˜¯ä¸€ä¸ªå¯åŠ¨ç±»ï¼Œä¸ºé¡¹ç›®çš„å…¥å£æ–‡ä»¶ã€‚                                                                              | ä»…ç”¨äºåº”ç”¨å¯åŠ¨ç±»                                          |
| `@ComponentScan(scanPath?: string | string[])`    | `scanPath` å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„                                               | å®šä¹‰é¡¹ç›®éœ€è¦è‡ªåŠ¨è£…è½½è¿›å®¹å™¨çš„ç›®å½•                                                                                        | ä»…ç”¨äºåº”ç”¨å¯åŠ¨ç±»                                          |
| `@Component(identifier?: string)`                 | `identifier` æ³¨å†Œåˆ°IOCå®¹å™¨çš„æ ‡è¯†ï¼Œé»˜è®¤å€¼ä¸ºç±»åã€‚                            | å®šä¹‰è¯¥ç±»ä¸ºä¸€ä¸ªç»„ä»¶ç±»                                                                                                    | ç¬¬ä¸‰æ–¹æ¨¡å—æˆ–å¼•å…¥ç±»ä½¿ç”¨                                    |
| `@ConfiguationScan(scanPath?: string | string[])` | `scanPath` å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ï¼Œé…ç½®æ–‡ä»¶çš„ç›®å½•                               | å®šä¹‰é¡¹ç›®éœ€è¦åŠ è½½çš„é…ç½®æ–‡ä»¶çš„ç›®å½•                                                                                        | ä»…ç”¨äºåº”ç”¨å¯åŠ¨ç±»                                          |
| `@Controller(path = "")`                          | `path` ç»‘å®šæ§åˆ¶å™¨è®¿é—®è·¯ç”±                                                   | å®šä¹‰è¯¥ç±»æ˜¯ä¸€ä¸ªæ§åˆ¶å™¨ç±»ï¼Œå¹¶ç»‘å®šè·¯ç”±ã€‚é»˜è®¤è·¯ç”±ä¸º"/"                                                                       | ä»…ç”¨äºæ§åˆ¶å™¨ç±»                                            |
| `@Service(identifier?: string)`                   | `identifier` æ³¨å†Œåˆ°IOCå®¹å™¨çš„æ ‡è¯†ï¼Œé»˜è®¤å€¼ä¸ºç±»åã€‚                            | å®šä¹‰è¯¥ç±»æ˜¯ä¸€ä¸ªæœåŠ¡ç±»                                                                                                    | ä»…ç”¨äºæœåŠ¡ç±»                                              |
| `@Middleware(identifier?: string)`                | `identifier` æ³¨å†Œåˆ°IOCå®¹å™¨çš„æ ‡è¯†ï¼Œé»˜è®¤å€¼ä¸ºç±»åã€‚                            | å®šä¹‰è¯¥ç±»æ˜¯ä¸€ä¸ªä¸­é—´ä»¶ç±»                                                                                                  | ä»…ç”¨äºä¸­é—´ä»¶ç±»                                            |
| `@EnableCacheStore()`                             |                                                                             | å¼€å¯ç¼“å­˜                                                                                                                | å¼€å¯åï¼Œ@CacheAbleã€@CacheEvictæ‰èƒ½ç”Ÿæ•ˆï¼Œä»…ç”¨äºåº”ç”¨å¯åŠ¨ç±» |
| `@EnableScheduleLock()`                           |                                                                             | å¼€å¯è®¡åˆ’ä»»åŠ¡æ‰§è¡Œé”                                                                                                      | å¼€å¯åï¼Œ@SchedulerLockæ‰èƒ½ç”Ÿæ•ˆï¼Œä»…ç”¨äºåº”ç”¨å¯åŠ¨ç±»          |
| `@BeforeEach(aopName: string)`                    | `aopName` åˆ‡ç‚¹æ‰§è¡Œçš„åˆ‡é¢ç±»å                                                | ä¸ºå½“å‰ç±»å£°æ˜ä¸€ä¸ªåˆ‡é¢ï¼Œåœ¨å½“å‰ç±»æ¯ä¸€ä¸ªæ–¹æ³•("constructor", "init", "__before", "__after"é™¤å¤–)æ‰§è¡Œä¹‹å‰æ‰§è¡Œåˆ‡é¢ç±»çš„runæ–¹æ³•ã€‚ |
| `@AfterEach(aopName: string)`                     | `aopName` åˆ‡ç‚¹æ‰§è¡Œçš„åˆ‡é¢ç±»å                                                | ä¸ºå½“å‰ç±»å£°æ˜ä¸€ä¸ªåˆ‡é¢ï¼Œåœ¨å½“å‰æ¯ä¸€ä¸ªæ–¹æ³•("constructor", "init", "__before", "__after"é™¤å¤–)æ‰§è¡Œä¹‹åæ‰§è¡Œåˆ‡é¢ç±»çš„runæ–¹æ³•ã€‚   |
### å±æ€§è£…é¥°å™¨

| è£…é¥°å™¨åç§°                                                                                      | å‚æ•°                                                                                                                                                                                                                       | è¯´æ˜                                                                 | å¤‡æ³¨ |
| ----------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------- | ---- |
| `@Autowired(identifier?: string, type?: CompomentType, constructArgs?: any[], isDelay = false)` | `identifier` æ³¨å†Œåˆ°IOCå®¹å™¨çš„æ ‡è¯†ï¼Œé»˜è®¤å€¼ä¸ºç±»å <br> `type` æ³¨å…¥beançš„ç±»å‹ <br> `constructArgs` æ³¨å…¥beanæ„é€ æ–¹æ³•å…¥å‚ã€‚å¦‚æœä¼ é€’è¯¥å‚æ•°ï¼Œåˆ™è¿”å›requestä½œç”¨åŸŸçš„å®ä¾‹ <br> `isDelay` æ˜¯å¦å»¶è¿ŸåŠ è½½ã€‚å»¶è¿ŸåŠ è½½ä¸»è¦æ˜¯è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ | ä»IOCå®¹å™¨è‡ªåŠ¨æ³¨å…¥beanåˆ°å½“å‰ç±»                                        |
| `@Value(key: string, type?: string)`                                                            | `key` é…ç½®é¡¹çš„key <br> `type` é…ç½®é¡¹ç±»å‹                                                                                                                                                                                   | é…ç½®é¡¹ç±»å‹è‡ªåŠ¨æ ¹æ®é…ç½®é¡¹æ‰€åœ¨æ–‡ä»¶æ¥å®šä¹‰ï¼Œä¾‹å¦‚ "db" ä»£è¡¨åœ¨ db.tsæ–‡ä»¶å†… |


### æ–¹æ³•è£…é¥°å™¨

| è£…é¥°å™¨åç§°                                                                                                                              | å‚æ•°                                                                                                                                                                                                                      | è¯´æ˜                                                            | å¤‡æ³¨                        |
| --------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------- | --------------------------- |
| `@Before(aopName: string)`                                                                                                              | `aopName` åˆ‡ç‚¹æ‰§è¡Œçš„åˆ‡é¢ç±»å                                                                                                                                                                                              | ä¸ºå½“å‰æ–¹æ³•å£°æ˜ä¸€ä¸ªåˆ‡é¢ï¼Œåœ¨å½“å‰æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œåˆ‡é¢ç±»çš„runæ–¹æ³•ã€‚ |
| `@After(aopName: string)`                                                                                                               | `aopName` åˆ‡ç‚¹æ‰§è¡Œçš„åˆ‡é¢ç±»å                                                                                                                                                                                              | ä¸ºå½“å‰æ–¹æ³•å£°æ˜ä¸€ä¸ªåˆ‡é¢ï¼Œåœ¨å½“å‰æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œåˆ‡é¢ç±»çš„runæ–¹æ³•ã€‚ |
| `@RequestMapping([path, requestMethod, routerOptions])`                                                                                 | `path` ç»‘å®šçš„è·¯ç”± <br> `requestMethod` ç»‘å®šçš„HTTPè¯·æ±‚æ–¹å¼ã€‚å¯ä»¥ä½¿ç”¨`RequestMethod` enumæ•°æ®è¿›è¡Œèµ‹å€¼ï¼Œä¾‹å¦‚ `RequestMethod.GET`ã€‚å¦‚æœè®¾ç½®ä¸º`RequestMethod.ALL`è¡¨ç¤ºæ”¯æŒæ‰€æœ‰è¯·æ±‚æ–¹å¼ <br> `routerOptions` koa/_routerçš„é…ç½®é¡¹ | ç”¨äºæ§åˆ¶å™¨æ–¹æ³•ç»‘å®šè·¯ç”±                                          | ä»…ç”¨äºæ§åˆ¶å™¨æ–¹æ³•            |
| `@GetMapping([path, routerOptions])`                                                                                                    | `path` ç»‘å®šçš„è·¯ç”± <br> `routerOptions` koa/_routerçš„é…ç½®é¡¹                                                                                                                                                                | ç”¨äºæ§åˆ¶å™¨æ–¹æ³•ç»‘å®šGetè·¯ç”±                                       | ä»…ç”¨äºæ§åˆ¶å™¨æ–¹æ³•            |
| `@PostMapping([path, routerOptions])`                                                                                                   | `path` ç»‘å®šçš„è·¯ç”± <br> `routerOptions` koa/_routerçš„é…ç½®é¡¹                                                                                                                                                                | ç”¨äºæ§åˆ¶å™¨æ–¹æ³•ç»‘å®šPostè·¯ç”±                                      | ä»…ç”¨äºæ§åˆ¶å™¨æ–¹æ³•            |
| `@DeleteMapping([path, routerOptions])`                                                                                                 | `path` ç»‘å®šçš„è·¯ç”± <br> `routerOptions` koa/_routerçš„é…ç½®é¡¹                                                                                                                                                                | ç”¨äºæ§åˆ¶å™¨æ–¹æ³•ç»‘å®šDeleteè·¯ç”±                                    | ä»…ç”¨äºæ§åˆ¶å™¨æ–¹æ³•            |
| `@PutMapping([path, routerOptions])`                                                                                                    | `path` ç»‘å®šçš„è·¯ç”± <br> `routerOptions` koa/_routerçš„é…ç½®é¡¹                                                                                                                                                                | ç”¨äºæ§åˆ¶å™¨æ–¹æ³•ç»‘å®šPutè·¯ç”±                                       | ä»…ç”¨äºæ§åˆ¶å™¨æ–¹æ³•            |
| `@PatchMapping([path, routerOptions])`                                                                                                  | `path` ç»‘å®šçš„è·¯ç”± <br> `routerOptions` koa/_routerçš„é…ç½®é¡¹                                                                                                                                                                | ç”¨äºæ§åˆ¶å™¨æ–¹æ³•ç»‘å®šPatchè·¯ç”±                                     | ä»…ç”¨äºæ§åˆ¶å™¨æ–¹æ³•            |
| `@OptionsMapping([path, routerOptions])`                                                                                                | `path` ç»‘å®šçš„è·¯ç”± <br> `routerOptions` koa/_routerçš„é…ç½®é¡¹                                                                                                                                                                | ç”¨äºæ§åˆ¶å™¨æ–¹æ³•ç»‘å®šOptionsè·¯ç”±                                   | ä»…ç”¨äºæ§åˆ¶å™¨æ–¹æ³•            |
| `@HeadMapping([path, routerOptions])`                                                                                                   | `path` ç»‘å®šçš„è·¯ç”± <br> `routerOptions` koa/_routerçš„é…ç½®é¡¹                                                                                                                                                                | ç”¨äºæ§åˆ¶å™¨æ–¹æ³•ç»‘å®šHeadè·¯ç”±                                      | ä»…ç”¨äºæ§åˆ¶å™¨æ–¹æ³•            |
| `@Scheduled(cron: string)`                                                                                                              | `cron` ä»»åŠ¡è®¡åˆ’é…ç½®<br> * * * * * <br> Seconds: 0-59<br>Minutes: 0-59<br>Hours: 0-23<br>Day of Month: 1-31<br>Months: 0-11 (Jan-Dec)<br>Day of Week: 0-6 (Sun-Sat)                                                        | å®šä¹‰ç±»çš„æ–¹æ³•æ‰§è¡Œè®¡åˆ’ä»»åŠ¡                                        | ä¸èƒ½ç”¨äºæ§åˆ¶å™¨æ–¹æ³•          |
| `@Validated()`                                                                                                                          |                                                                                                                                                                                                                           | é…åˆDTOç±»å‹è¿›è¡Œå‚æ•°éªŒè¯                                         | æ–¹æ³•å…¥å‚æ²¡æœ‰DTOç±»å‹çš„ä¸ç”Ÿæ•ˆ |
| `@SchedulerLock(name?: string, lockTimeOut?: number, waitLockInterval?: number, waitLockTimeOut?: number, redisOptions?: RedisOptions)` | `name` é”çš„åç§°<br> `lockTimeOut` é”è‡ªåŠ¨è¶…æ—¶æ—¶é—´<br> `waitLockInterval` å°è¯•å¾ªç¯è·å–é”æ—¶é—´é—´éš” <br>`waitLockTimeOut` å°è¯•å¾ªç¯è·å–é”æœ€é•¿ç­‰å¾…æ—¶é—´<br> `redisOptions` redisæœåŠ¡å™¨è¿æ¥é…ç½®                                    | å®šä¹‰æ–¹æ³•æ‰§è¡Œæ—¶å¿…é¡»å…ˆè·å–åˆ†å¸ƒå¼é”(åŸºäºRedis)                     |
| `@CacheAble(cacheName: string, paramKey?: number \| number[], redisOptions?: RedisOptions)`                                             | `cacheName` ç¼“å­˜name <br> `paramKey`åŸºäºæ–¹æ³•å…¥å‚ä½œä¸ºç¼“å­˜key,å€¼ä¸ºæ–¹æ³•å…¥å‚çš„ä½ç½®,ä»0å¼€å§‹è®¡æ•° <br> `redisOptions` RedisæœåŠ¡å™¨è¿æ¥é…ç½®                                                                                        | åŸºäºRedisçš„ç¼“å­˜                                                 | ä¸èƒ½ç”¨äºæ§åˆ¶å™¨æ–¹æ³•          |
| `@CacheEvict(cacheName: string, paramKey?: number \| number[], eventTime: eventTimes = "Before", redisOptions?: RedisOptions)`          | `cacheName` ç¼“å­˜name <br> `paramKey`åŸºäºæ–¹æ³•å…¥å‚ä½œä¸ºç¼“å­˜key,å€¼ä¸ºæ–¹æ³•å…¥å‚çš„ä½ç½®,ä»0å¼€å§‹è®¡æ•° <br> `eventTime` æ¸…é™¤ç¼“å­˜çš„æ—¶ç‚¹ <br>`redisOptions` RedisæœåŠ¡å™¨è¿æ¥é…ç½®                                                         | åŒ@Cacheableé…åˆä½¿ç”¨ï¼Œç”¨äºæ–¹æ³•æ‰§è¡Œæ—¶æ¸…ç†ç¼“å­˜                    | ä¸èƒ½ç”¨äºæ§åˆ¶å™¨æ–¹æ³•          |

### å‚æ•°è£…é¥°å™¨

| è£…é¥°å™¨åç§°                                                               | å‚æ•°                                                                                   | è¯´æ˜                                    | å¤‡æ³¨                 |
| ------------------------------------------------------------------------ | -------------------------------------------------------------------------------------- | --------------------------------------- | -------------------- |
| `@File(name?: string)`                                                   | `name` æ–‡ä»¶å                                                                          | è·å–ä¸Šä¼ çš„æ–‡ä»¶å¯¹è±¡                      | ä»…ç”¨äºæ§åˆ¶å™¨æ–¹æ³•å‚æ•° |
| `@Get(name?: string)`                                                    | `name` å‚æ•°å                                                                          | è·å–querystringå‚æ•°(è·å–è·¯ç”±ç»‘å®šçš„å‚æ•°) | ä»…ç”¨äºæ§åˆ¶å™¨æ–¹æ³•å‚æ•° |
| `@Header(name?: string)`                                                 | `name` å‚æ•°å                                                                          | è·å–Headerå†…å®¹                          | ä»…ç”¨äºæ§åˆ¶å™¨æ–¹æ³•å‚æ•° |
| `@PathVariable(name?: string)`                                           | `name` å‚æ•°å                                                                          | è·å–è·¯ç”±ç»‘å®šçš„å‚æ•° /user/:id            | ä»…ç”¨äºæ§åˆ¶å™¨æ–¹æ³•å‚æ•° |
| `@Post(name?: string)`                                                   | `name` å‚æ•°å                                                                          | è·å–Postå‚æ•°                            | ä»…ç”¨äºæ§åˆ¶å™¨æ–¹æ³•å‚æ•° |
| `@RequestBody()`                                                         |                                                                                        | è·å–ctx.body                            | ä»…ç”¨äºæ§åˆ¶å™¨æ–¹æ³•å‚æ•° |
| `@RequestParam(name?: string)`                                           | `name` å‚æ•°å                                                                          | è·å–Getæˆ–Postå‚æ•°ï¼ŒPostä¼˜å…ˆ             | ä»…ç”¨äºæ§åˆ¶å™¨æ–¹æ³•å‚æ•° |
| `@Valid(rule: ValidRules \| ValidRules[] \| Function, message?: string)` | `rule` éªŒè¯è§„åˆ™,æ”¯æŒå†…ç½®è§„åˆ™æˆ–è‡ªå®šä¹‰å‡½æ•° <br> `message` è§„åˆ™åŒ¹é…ä¸é€šè¿‡æ—¶æç¤ºçš„é”™è¯¯ä¿¡æ¯ | ç”¨äºå‚æ•°æ ¼å¼éªŒè¯                        |


# API

## App
--

app æ˜¯å…¨å±€åº”ç”¨å¯¹è±¡ï¼Œæ˜¯åº”ç”¨Appçš„å®ä¾‹ï¼Œå®ƒç»§æ‰¿è‡ª Koa.Applicationã€‚

### init()

æ¡†æ¶å®šä¹‰çš„æ„é€ æ–¹æ³•ï¼Œç”¨æ¥ä»£æ›¿constructor.

### getMap(key) 

è¯»å–åº”ç”¨ç¼“å­˜å€¼å¹¶è¿”å›ã€‚åº”ç”¨ç¼“å­˜ä¸€èˆ¬ä¿å­˜ç€åº”ç”¨è¿è¡Œæ—¶å¿…è¦çš„ä¸€äº›æ•°æ®ï¼Œä¾‹å¦‚é…ç½®ã€å…¨å±€å‚æ•°ç­‰ã€‚

* key ç¼“å­˜key

### setMap(key, value)

å†™å…¥åº”ç”¨ç¼“å­˜ã€‚

  * key ç¼“å­˜key
  * value  ç¼“å­˜å€¼

### use(fn)

ç»‘å®šè¿è¡Œkoaä¸­é—´ä»¶ã€‚

* fn koaä¸­é—´ä»¶å‡½æ•°

### useExp(fn)

ç»‘å®šè¿è¡Œexpressä¸­é—´ä»¶ã€‚

* fn expressä¸­é—´ä»¶

### config(name, type = "config")

è¯»å–é¡¹ç›®åŠåº”ç”¨é…ç½®ã€‚åŒ…æ‹¬æœ¬åœ°é…ç½®æ–‡ä»¶ä¸­çš„é¡¹ç›®é…ç½®ã€ä¸­é—´ä»¶é…ç½®ã€è·¯ç”±é…ç½®ç­‰ï¼Œè¿˜åŒ…æ‹¬ä»apolloç­‰é…ç½®ä¸­å¿ƒä¸­è·å–åˆ°çš„é…ç½®

* name é…ç½®key
* type é…ç½®ç±»å‹ï¼Œé»˜è®¤ä¸º `config` é¡¹ç›®é…ç½®ã€‚å¦‚æœæ˜¯æœ¬åœ°é…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶åå°±æ˜¯ç±»å‹åï¼›å¦‚æœæ˜¯é…ç½®ä¸­å¿ƒï¼Œåˆ™å¯ä»¥è‡ªè¡Œå®šä¹‰ï¼Œä¾‹å¦‚ apollo ä¸­æ·»åŠ é…ç½®é¡¹ mongodb.hostï¼Œç±»å‹ä¸º mongodb


## Ctx
--

koa.ctxå¯¹è±¡ï¼Œ[APIæ–‡æ¡£](https://koajs.com/#context)ã€‚


## IOCContainer
--

### reg<T>(target: T, options?: ObjectDefinitionOptions): T;
### reg<T>(identifier: string, target: T, options?: ObjectDefinitionOptions): T;

æ³¨å†ŒBeanåˆ°IOCå®¹å™¨ã€‚

* target ç±»æˆ–è€…ç±»çš„å®ä¾‹
* identifier  åˆ«åï¼Œé»˜è®¤ä½¿ç”¨ç±»åã€‚å¦‚æœè‡ªå®šä¹‰ï¼Œä»å®¹å™¨ä¸­è·å–ä¹Ÿéœ€è¦ä½¿ç”¨è‡ªå®šä¹‰åˆ«å
* options Beançš„é…ç½®ï¼ŒåŒ…å«ä½œç”¨åŸŸã€ç”Ÿå‘½å‘¨æœŸã€ç±»å‹ç­‰ç­‰

### get(identifier: string, type?: CompomentType, args?: any[]): any;

ä»å®¹å™¨ä¸­è·å–Beanã€‚

* identifier  åˆ«åï¼Œé»˜è®¤ä½¿ç”¨ç±»åã€‚å¦‚æœè‡ªå®šä¹‰ï¼Œä»å®¹å™¨ä¸­è·å–ä¹Ÿéœ€è¦ä½¿ç”¨è‡ªå®šä¹‰åˆ«å
* type 'COMPONENT' | 'CONTROLLER' | 'MIDDLEWARE' | 'SERVICE' å››ç§ç±»å‹ã€‚
* args æ„é€ æ–¹æ³•å…¥å‚ï¼Œå¦‚æœä¼ å…¥å‚æ•°ï¼Œè·å–çš„Beané»˜è®¤ç”Ÿå‘½å‘¨æœŸä¸ºPrototypeï¼Œå¦åˆ™ä¸ºå•ä¾‹Singleton

### getClass(identifier: string, type?: CompomentType): Function;

ä»å®¹å™¨ä¸­è·å–ç±»çš„åŸå‹ã€‚

* identifier  åˆ«åï¼Œé»˜è®¤ä½¿ç”¨ç±»åã€‚å¦‚æœè‡ªå®šä¹‰ï¼Œä»å®¹å™¨ä¸­è·å–ä¹Ÿéœ€è¦ä½¿ç”¨è‡ªå®šä¹‰åˆ«å
* type 'COMPONENT' | 'CONTROLLER' | 'MIDDLEWARE' | 'SERVICE' å››ç§ç±»å‹ã€‚

### getInsByClass<T>(target: T, args?: any[]): T;

æ ¹æ®classç±»è·å–å®¹å™¨ä¸­çš„å®ä¾‹

* target ç±»
* args æ„é€ æ–¹æ³•å…¥å‚ï¼Œå¦‚æœä¼ å…¥å‚æ•°ï¼Œè·å–çš„Beané»˜è®¤ç”Ÿå‘½å‘¨æœŸä¸ºPrototypeï¼Œå¦åˆ™ä¸ºå•ä¾‹Singleton



## BaseController
--

### init()

æ¡†æ¶å®šä¹‰çš„æ„é€ æ–¹æ³•ï¼Œç”¨æ¥ä»£æ›¿constructor.

### __before()
æ§åˆ¶å™¨é»˜è®¤å‰ç½®åˆ‡é¢æ–¹æ³•ã€‚åœ¨æ§åˆ¶å™¨æ–¹æ³•(ç»‘å®šè·¯ç”±çš„)æ‰§è¡Œä¹‹å‰è‡ªåŠ¨è°ƒç”¨ã€‚è¯¥æ–¹æ³•å¯ä»¥æ˜¯å¼‚æ­¥çš„ï¼Œæ— è¿”å›å€¼ã€‚ç»å¸¸ç”¨äºå‰ç½®æƒé™æ£€æŸ¥ç­‰åœºæ™¯ã€‚

```js
//src/controller/index.jsæ§åˆ¶å™¨
 ...
 __before(){
     console.log('hello');
 }
 
 @GetMapping("/index")
 index(){
     return this.write('hello world');
 }
 ...

 //å½“è®¿é—® /indexè·¯ç”±æ—¶ï¼Œå…ˆæ‰“å° 'hello' åˆ°æ§åˆ¶å°ï¼Œ ç„¶åè¾“å‡ºé¡µé¢
```

### __after()
æ§åˆ¶å™¨é»˜è®¤åç½®åˆ‡é¢æ–¹æ³•ã€‚åœ¨æ§åˆ¶å™¨æ–¹æ³•(ç»‘å®šè·¯ç”±çš„)æ‰§è¡Œä¹‹åè‡ªåŠ¨è°ƒç”¨ã€‚è¯¥æ–¹æ³•å¯ä»¥æ˜¯å¼‚æ­¥çš„ï¼Œæ— è¿”å›å€¼ã€‚

### isGet()

åˆ¤æ–­å½“å‰requestæ˜¯å¦GETè¯·æ±‚ã€‚

```js
if (this.isGet()) {
    //å½“å‰è¯·æ±‚ä¸ºGETè¯·æ±‚
}
```

### isPost()

åˆ¤æ–­å½“å‰requestæ˜¯å¦POSTè¯·æ±‚ã€‚

```js
if (this.isPost()) {
    //å½“å‰è¯·æ±‚ä¸ºPOSTè¯·æ±‚
}
```

### isMethod(method)

* method è¯·æ±‚ç±»å‹ get/postç­‰

åˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦æ˜¯ä¼ å…¥çš„ç‰¹å®šè¯·æ±‚ã€‚

```js
if (this.isMethod('get')) {
    //å½“å‰è¯·æ±‚ä¸ºGETè¯·æ±‚
}
```

### header(name, value)

è·å–æˆ–è®¾ç½®headerå†…å®¹ã€‚

* name é”®
* value å€¼

```js
this.header('Content-Type', 'text/plian'); //ç­‰åŒäº ctx.set('Content-Type', 'text/plian')

this.header('Content-Type'); //ç­‰åŒäº ctx.get('Content-Type')
```

### param([name])
* name å‚æ•°å,å¦‚æœå€¼ä¸ºundefinedåˆ™è¿”å›æ‰€æœ‰querystringä»¥åŠpostå‚æ•°
        querystringä¸­åŒåkeyä¼šè¢«postå€¼è¦†ç›–
è·å–å‚æ•°ï¼Œå…ˆä»postå‚æ•°ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä»querstringä¸­æŸ¥æ‰¾ã€‚

```js
let all = this.param();

let info = this.param('info') || {};

```

### type(contentType[, encoding])

* contentType æ–‡æ¡£ç±»å‹
* encoding ç¼–ç æ ¼å¼,é»˜è®¤å€¼ä¸º'utf-8'
content-type æ“ä½œã€‚

```js
this.type('text/plian', 'utf-8');
```

### expires(timeout = 30)

* timeout ç¼“å­˜æ—¶é—´ï¼Œå•ä½ç§’

è®¾ç½®`Cache-Control`çš„`max-age`çš„å€¼


### redirect(urls[, alt])

* urls éœ€è¦è·³è½¬çš„url
* alt å®šä¹‰Referrer
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
é¡µé¢è·³è½¬ã€‚

```js
this.redirect('/index');

this.redirect('http://baidu.com');
```

### deny([code = 403])
è¿”å›403ç¦æ­¢è®¿é—®ã€‚

```js
return this.deny();
```

### body(data[, contentType, encoding])

å¯¹ctx.bodyèµ‹å€¼è¿›è¡ŒåŠŸèƒ½å°è£…ã€‚ æ³¨æ„æ§åˆ¶å™¨ä¸­çš„this.bodyæ–¹æ³•å’Œç›´æ¥å¯¹ctx.bodyèµ‹å€¼æœ€å¤§çš„ä¸åŒæ˜¯è¾“å‡ºå†…å®¹åï¼Œthis.bodyæ–¹æ³•ä¼šè¿”å›think.prevent()é”™è¯¯ä¸­æ–­ç¨‹åºæ‰§è¡Œã€‚

* content è¾“å‡ºçš„å†…å®¹
* contentType è¾“å‡ºæ–‡æ¡£ç±»å‹ï¼Œé»˜è®¤ `text/plain`
* encoding è¾“å‡ºæ–‡æ¡£ç¼–ç ï¼Œé»˜è®¤ `utf-8`ï¼Œåœ¨é¡¹ç›®é…ç½®æ–‡ä»¶ src/config/config.jså†…å¯ä¿®æ”¹

```js
return this.body('content', 'text/plain'); //é¡µé¢è¾“å‡º content
```

### json(data)

* data è¾“å‡ºçš„æ•°æ®

responseè¿”å›jsonæ ¼å¼æ•°æ®ã€‚å¸¸ç”¨äºAPIæ¥å£ã€‚

```js
return this.json({aa: 111, bb: 222}); //é¡µé¢è¾“å‡º   {"aa": 111, "bb":222}
```

### ok(errmsg[, data, code = 200, options = {}])

* errmsg è¾“å‡ºçš„ä¿¡æ¯
* data è¾“å‡ºçš„æ•°æ®
* code é”™è¯¯ç 
* options é€‰é¡¹

åœ¨æ§åˆ¶å™¨é€»è¾‘æ‰§è¡ŒæˆåŠŸæ—¶,responseè¿”å›ç»Ÿä¸€æ ¼å¼åŒ–jsonæ•°æ®ã€‚å¸¸ç”¨äºAPIæ¥å£ã€‚

```js
return this.success('æ“ä½œæˆåŠŸ'); //é¡µé¢è¾“å‡º {"status":1,"errno":200,"errmsg":"æ“ä½œæˆåŠŸ","data":{}}
```

### fail(errmsg[, data, code = 500, options = {}])

* errmsg è¾“å‡ºçš„ä¿¡æ¯
* data è¾“å‡ºçš„æ•°æ®
* code é”™è¯¯ç 
* options é€‰é¡¹

åœ¨æ§åˆ¶å™¨é€»è¾‘æ‰§è¡Œå¤±è´¥æ—¶,responseè¿”å›ç»Ÿä¸€æ ¼å¼åŒ–jsonæ•°æ®ã€‚å¸¸ç”¨äºAPIæ¥å£ã€‚

```js
return this.error('æ“ä½œå¤±è´¥'); //é¡µé¢è¾“å‡º {"status":0,"errno":500,"errmsg":"æ“ä½œå¤±è´¥","data":{}}
```
### prevent()

æŠ›å‡ºä¸€ä¸ªpreventå¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸å¹¶ä¸ä¼šç›´æ¥æŠ›å‡ºé”™è¯¯ï¼Œè€Œæ˜¯è‡ªåŠ¨è¢«æ¡†æ¶æ‹¦æˆªï¼Œä½œç”¨æ˜¯ä¸­æ–­åç»­ä»£ç æ‰§è¡Œã€‚ä¸€èˆ¬åœ¨responseè¿”å›åè°ƒç”¨ï¼Œé˜²æ­¢responseè¢«é‡å¤æ‰§è¡Œ


# ç¼–ç¨‹è§„èŒƒå’Œçº¦å®š

Koattyéµå¾ªçº¦å®šå¤§äºé…ç½®çš„åŸåˆ™ã€‚ä¸ºè§„èŒƒé¡¹ç›®ä»£ç ï¼Œæé«˜å¥å£®æ€§ï¼Œåšäº†ä¸€äº›é»˜è®¤çš„è§„èŒƒå’Œçº¦å®šã€‚

## Koattyæ¡†æ¶åŠå‘¨è¾¹ç»„ä»¶ç‰ˆæœ¬å®šä¹‰

* å°ç‰ˆæœ¬ï¼Œå¦‚ï¼š1.1.1 => 1.1.2ï¼ˆå°åŠŸèƒ½å¢åŠ ï¼Œbug ä¿®å¤ç­‰ï¼Œå‘ä¸‹å…¼å®¹1.1.xï¼‰

* ä¸­ç‰ˆæœ¬ï¼Œå¦‚ï¼š1.1.0 => 1.2.0ï¼ˆè¾ƒå¤§åŠŸèƒ½å¢åŠ ï¼Œéƒ¨åˆ†æ¨¡å—é‡æ„ç­‰ã€‚ä¸»ä½“å‘ä¸‹å…¼å®¹ï¼Œå¯èƒ½å­˜åœ¨å°‘é‡ç‰¹æ€§ä¸å…¼å®¹ï¼‰

* å¤§ç‰ˆæœ¬ï¼Œå¦‚ï¼š1.0.0 => 2.0.0ï¼ˆæ¡†æ¶æ•´ä½“è®¾è®¡ã€é‡æ„ç­‰ï¼Œä¸å‘ä¸‹å…¼å®¹ï¼‰

## ç¼–ç¨‹é£æ ¼

* ä»¥ClassèŒƒå¼ç¼–ç¨‹
  
  åŒ…æ‹¬Controllerã€Serviceã€Modelç­‰ç±»å‹çš„ç±»ï¼Œä½¿ç”¨`Class` è€Œé `function`æ¥ç»„ç»‡ä»£ç ã€‚é…ç½®ã€å·¥å…·ã€å‡½æ•°åº“ã€ç¬¬ä¸‰æ–¹åº“é™¤å¤–ã€‚

* å•ä¸ªæ–‡ä»¶ä»…exportä¸€ä¸ªç±»

åœ¨é¡¹ç›®ä¸­ï¼Œå•ä¸ª`.ts`æ–‡ä»¶ä»…`export`ä¸€æ¬¡ä¸”å¯¼å‡ºçš„æ˜¯`Class`ã€‚é…ç½®ã€å·¥å…·ã€å‡½æ•°åº“ã€ç¬¬ä¸‰æ–¹åº“é™¤å¤–ã€‚

* ç±»åå¿…é¡»ä¸æ–‡ä»¶åç›¸åŒ

ç†Ÿæ‚‰JAVAçš„äººå¯¹æ­¤ä¸€å®šä¸ä¼šé™Œç”Ÿã€‚ç±»ååŒæ–‡ä»¶åå¿…é¡»ç›¸åŒï¼Œä½¿å¾—åœ¨IOCå®¹å™¨å†…ä¿æŒå”¯ä¸€æ€§ï¼Œé˜²æ­¢ç±»è¢«è¦†ç›–ã€‚

* åŒç±»å‹ä¸å…è®¸å­˜åœ¨åŒåç±»
  
Koattyå°†IOCå®¹å™¨å†…çš„Beanåˆ†ä¸º 'COMPONENT' | 'CONTROLLER' | 'MIDDLEWARE' | 'SERVICE' å››ç§ç±»å‹ã€‚

ç›¸åŒç±»å‹çš„Beanä¸å…è®¸æœ‰åŒåçš„ç±»ï¼Œå¦åˆ™ä¼šå¯¼è‡´è£…è½½å¤±è´¥ã€‚

ä¾‹å¦‚ï¼š`src/Controller/IndexController.ts` å’Œ `src/Controller/Test/IndexController.ts`å°±æ˜¯åŒåç±»ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒBeançš„ç±»å‹æ˜¯ç”±è£…é¥°å™¨å†³å®šçš„è€Œéæ–‡ä»¶åæˆ–ç›®å½•åã€‚ç»™`IndexController.ts`åŠ  `@Service()`è£…é¥°å™¨çš„è¯é‚£ä¹ˆå®ƒçš„ç±»å‹å°±æ˜¯`SERVICE`ã€‚

